<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DriverApp.ViewModels"
             xmlns:helpers="clr-namespace:DriverApp.Helpers"
             x:Class="DriverApp.Views.EarningsView"
             BackgroundColor="White">

    <ContentView.Resources>
        <helpers:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <!-- Keep if you need it elsewhere -->
        <helpers:TabSelectionConverter x:Key="TabSelectionConverter"/>
    </ContentView.Resources>

    <VerticalStackLayout Padding="10">
        <Label Text="Earnings Summary"
               FontSize="20"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,0" />

        <!-- Tabs (Day / Week / Month) -->
        <Grid ColumnDefinitions="*,*,*" Margin="0,20,0,10">
            <Button Text="Day"
                    Grid.Column="0"
                    BackgroundColor="Transparent"
                    TextColor="Black"
                    Clicked="OnDayClicked"/>
            <Button Text="Week"
                    Grid.Column="1"
                    BackgroundColor="Transparent"
                    TextColor="Black"
                    Clicked="OnWeekClicked"/>
            <Button Text="Month"
                    Grid.Column="2"
                    BackgroundColor="Transparent"
                    TextColor="Black"
                    Clicked="OnMonthClicked"/>
        </Grid>

        <!-- Date Ranges -->
        <CollectionView x:Name="RangesList"
                        ItemsSource="{Binding DateRanges}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedRange, Mode=TwoWay}"
                        HeightRequest="50">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="8"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12,6"
                           CornerRadius="20"
                           BorderColor="LightGray"
                           HasShadow="False"
                           VerticalOptions="Center"
                           HorizontalOptions="Start">
                        <Label Text="{Binding Label}"
                               FontSize="14"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               TextColor="Black">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label"
                                             Binding="{Binding IsSelected}"
                                             Value="True">
                                    <Setter Property="TextColor" Value="White"/>
                                    <Setter Property="FontAttributes" Value="Bold"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>

                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding IsSelected}"
                                         Value="True">
                                <Setter Property="BackgroundColor" Value="#007AFF"/>
                                <Setter Property="BorderColor" Value="#007AFF"/>
                            </DataTrigger>
                        </Frame.Triggers>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Summary Section -->
        <Frame BackgroundColor="#F5F5F5"
               CornerRadius="12"
               Padding="15"
               Margin="0,20,0,10"
               HasShadow="False">
            <VerticalStackLayout Spacing="8">
                <Label Text="Completed Orders"
                       FontSize="14"
                       TextColor="Gray"/>
                <Label Text="{Binding CompletedOrders}"
                       FontSize="18"
                       FontAttributes="Bold"/>

                <Label Text="Total Earnings"
                       FontSize="14"
                       TextColor="Gray"
                       Margin="0,10,0,0"/>
                <Label Text="{Binding TotalEarnings, StringFormat='â‚¹{0:F2}'}"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="Green"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Order Status Tabs (use Label + Frame so TextDecorations works) -->
        <Grid ColumnDefinitions="*,*,*" Margin="0,10,0,10">

            <!-- Completed -->
            <Frame Grid.Column="0"
                   Padding="8,6"
                   CornerRadius="12"
                   HasShadow="False"
                   BackgroundColor="Transparent">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ChangeOrderTypeCommand}"
                                          CommandParameter="Completed" />
                </Frame.GestureRecognizers>

                <Label Text="Completed"
                       TextColor="Green"
                       HorizontalOptions="Center">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                     Binding="{Binding SelectedOrderHistoryType}"
                                     Value="Completed">
                            <Setter Property="FontAttributes" Value="Bold"/>
                            <Setter Property="TextDecorations" Value="Underline"/>
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <Frame.Triggers>
                    <DataTrigger TargetType="Frame"
                                 Binding="{Binding SelectedOrderHistoryType}"
                                 Value="Completed">
                        <Setter Property="BackgroundColor" Value="#DFF5E1"/>
                    </DataTrigger>
                </Frame.Triggers>
            </Frame>

            <!-- In Progress -->
            <Frame Grid.Column="1"
                   Padding="8,6"
                   CornerRadius="12"
                   HasShadow="False"
                   BackgroundColor="Transparent">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ChangeOrderTypeCommand}"
                                          CommandParameter="InProgress" />
                </Frame.GestureRecognizers>

                <Label Text="In Progress Rides"
                       TextColor="#E39B00"
                       HorizontalOptions="Center">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                     Binding="{Binding SelectedOrderHistoryType}"
                                     Value="InProgress">
                            <Setter Property="FontAttributes" Value="Bold"/>
                            <Setter Property="TextDecorations" Value="Underline"/>
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <Frame.Triggers>
                    <DataTrigger TargetType="Frame"
                                 Binding="{Binding SelectedOrderHistoryType}"
                                 Value="InProgress">
                        <Setter Property="BackgroundColor" Value="#FFF3CC"/>
                    </DataTrigger>
                </Frame.Triggers>
            </Frame>

            <!-- Cancelled -->
            <Frame Grid.Column="2"
                   Padding="8,6"
                   CornerRadius="12"
                   HasShadow="False"
                   BackgroundColor="Transparent">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ChangeOrderTypeCommand}"
                                          CommandParameter="Cancelled" />
                </Frame.GestureRecognizers>

                <Label Text="Cancelled"
                       TextColor="Red"
                       HorizontalOptions="Center">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                     Binding="{Binding SelectedOrderHistoryType}"
                                     Value="Cancelled">
                            <Setter Property="FontAttributes" Value="Bold"/>
                            <Setter Property="TextDecorations" Value="Underline"/>
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <Frame.Triggers>
                    <DataTrigger TargetType="Frame"
                                 Binding="{Binding SelectedOrderHistoryType}"
                                 Value="Cancelled">
                        <Setter Property="BackgroundColor" Value="#FFD6D6"/>
                    </DataTrigger>
                </Frame.Triggers>
            </Frame>
        </Grid>

        <Label Text="{Binding Message}"
               FontSize="14"
               TextColor="Blue"
               Margin="0,10,0,0"/>

        <!-- Orders List -->
        <CollectionView x:Name="OrdersCollection"
                        ItemsSource="{Binding Orders}"
                        SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,0,0,10"
                           CornerRadius="10"
                           HasShadow="True"
                           BorderColor="LightGray">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer
                                Command="{Binding BindingContext.OrderTappedCommand, Source={x:Reference OrdersCollection}}"
                                CommandParameter="{Binding}" />
                        </Frame.GestureRecognizers>

                        <VerticalStackLayout>
                            <HorizontalStackLayout>
                                <Label Text="{Binding date}" FontAttributes="Bold"/>
                                <Label Text="{Binding time}" Margin="10,0,0,0"/>
                                <Label Text="{Binding amount, StringFormat='â‚¹{0:F2}'}"
                                       HorizontalOptions="EndAndExpand"
                                       FontAttributes="Bold"
                                       TextColor="Green"/>
                            </HorizontalStackLayout>
                            <Label Text="{Binding pickuppoint}" FontSize="12"/>
                            <Label Text="{Binding destination}" FontSize="12"/>
                            <Label Text="{Binding status}"
                                   FontAttributes="Bold"
                                   TextColor="{Binding status, Converter={StaticResource StatusToColorConverter}}"/>
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentView>
